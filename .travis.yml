sudo: required

dist: trusty

#osx_image: xcode7.3

os:
  - linux
#  - osx

language: cpp

node_js:
  - node

branches:
  only: master

git:
  depth: false

before_install:
  - test $TRAVIS_OS_NAME == "osx" && brew install --with-default-names gnu-sed || :;
  - test $TRAVIS_OS_NAME == "linux" && make travis-gcc || make travis-dist;

install:
  - test $TRAVIS_OS_NAME == "linux" && (yes 1 | make install) || :;
  - test $TRAVIS_OS_NAME == "osx" && (yes 4 | make install) || :;

script:
  - test $TRAVIS_OS_NAME == "linux" && (KCOV=1 make dist bundle K && ./K.sh --version) || :;
#  - test $TRAVIS_OS_NAME == "linux" && make test-c || :;
#  - make test-cov

after_success: make send-cov

notifications:
  email:
    on_success: never
